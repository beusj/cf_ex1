<!DOCTYPE html>
<html lang="en">
    <head>
		<meta http-equiv="content-type" content="text/html; charset=UTF8"> 
        <title>Page Template</title>
		<script type="text/javascript" src="javascripts/d3.js"></script>
		<script type="text/javascript" src="javascripts/crossfilter.js"></script>
		<script type="text/javascript" src="javascripts/dc.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.js" type="text/javascript"></script>
		<link rel="stylesheet" type="text/css" href="dc.css" media="screen" /> 
    </head>
<body>
	<div id="table-data"></div>
	
        <script type="text/javascript">
        	d3.csv("data/demo.csv", function(data) {
			var dateFormat = d3.time.format('%m/%d/%Y');

			data.forEach(function (d) {
				d.dd = dateFormat.parse(d.date);
				d.month = d3.time.month(d.dd); // pre-calculate month for better performance
				d.Year = d3.time.year(d.dd).getFullYear();
				});
    		//### Create Crossfilter Dimensions and Groups
    		//See the [crossfilter API](https://github.com/square/crossfilter/wiki/API-Reference) for reference.
    			var ndx = crossfilter(data);
    			var all = ndx.groupAll();

    		// Dimension by year
			var yearlyDimension = ndx.dimension(function (d) {
				return +d.Year
			});
    

			// Dimension by month
			var dimMonths = ndx.dimension(function (d) {
				return d.month;
			});
        
			//var hitslineChart  = dc.lineChart("#chart-line-hitsperday");


			var dateDim = ndx.dimension(function(d) {return d.date;});
			var minDate = dateDim.bottom(1)[0].date;
			var maxDate = dateDim.top(1)[0].date;
			
			var dimPtDay = ndx.dimension(function(d) {return d.pt_days_id;});
			var totPtDay = dimPtDay.group.size();

		//var yearRingChart   = dc.pieChart("#chart-ring-year");
		var yearDim  = ndx.dimension(function(d) {return +d.Year;});
		var dTable = dc.dataTable("#table-data")
		//var year_total = yearDim.group().reduceSum(function(d) {return d.http_200+d.http_302;});

		//yearRingChart
		//	.width(150).height(150)
		//	.dimension(yearDim)
		//	.group(year_total)
		//	.innerRadius(30);
		dTable
		 	.dimension(dimPtDay)
		        .group(function (d) {
		            return d.dd.getFullYear();
		        })
			.width(768)
			.height(480)
			.columns([
            			'date',
            			'totPtDay'
        		])
		dc.renderAll();
        	});
        </script>
    </body>
</html>


